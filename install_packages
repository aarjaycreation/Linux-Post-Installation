#!/bin/bash

# Define a list of main packages
packages=(
    "xorg-dev"
    "sxhkd"
    "firefox-esr"
    "tilix"
    "kitty"
    "flameshot"
    "ranger"
)

# Function to read and append common packages from a file
read_common_packages() {
    local common_file="$1"
    if [ -f "$common_file" ]; then
        while IFS= read -r pkg; do
            # Ignore empty lines and comments
            [[ -z "$pkg" || "$pkg" =~ ^# ]] && continue
            packages+=("$pkg")
        done < "$common_file"
    else
        echo "Common packages file not found: $common_file"
        exit 1
    fi
}

# Function to install packages if they are not already installed
install_packages() {
    local pkgs=("$@")
    local missing_pkgs=()

    # Check if each package is installed
    for pkg in "${pkgs[@]}"; do
        if ! dpkg -l | grep -qw "$pkg"; then
            missing_pkgs+=("$pkg")
        fi
    done

    # Install missing packages
    if [ ${#missing_pkgs[@]} -gt 0 ]; then
        echo "Installing missing packages: ${missing_pkgs[@]}"
        sudo apt update
        sudo apt install -y "${missing_pkgs[@]}"
        if [ $? -ne 0 ]; then
            echo "Failed to install some packages. Exiting."
            exit 1
        fi
    else
        echo "All required packages are already installed."
    fi
}

# Read additional common packages from file
common_packages_file="$HOME/Linux-Post-Installation/common_packages.txt"
read_common_packages "$common_packages_file"

# Call function to install packages
install_packages "${packages[@]}"
